<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>HCMUS-GPA-bookmarklet</title>
</head>
<body>
    <div class="main">
        <a style="text-decoration: none" class="script" href="javascript: (() => {
            const credits = document.querySelectorAll('td:nth-child(3)');
            const courses = document.querySelectorAll('td:nth-child(2)');
            const grades = document.querySelectorAll('td:nth-child(6)');
        
            let totalGrades = 0;
            let totalCredits = 0;
            let totalCourses = 0;
            let totalFourScaleGrades = 0;
            const courseData = {};
            
            function getFourScaleGrade(grade) {
                if (grade >= 9) return 4;
                if (grade < 3) return 0;
                return 1 + (grade - 3)/2;
            }
        
            for (let i = 1; i < credits.length; i++) {
                const grade = Number(grades[i].innerText);
                const courseName = courses[i].innerText;
                if (
                    courseName.includes('Thể dục') ||
                    courseName.includes('Anh văn') ||
                    courseName.includes('Tin học cơ sở') ||
                    courseName.includes('Giáo dục quốc phòng') ||
                    !grade || grade < 5
                ) { continue; }
                
                const credit = Number(credits[i].innerText);
                courseData[courseName] = [credit, grade];
            }
        
            Object.values(courseData).forEach(([credit, grade]) => {
                totalGrades += credit * grade;
                totalFourScaleGrades += credit * getFourScaleGrade(grade);
                totalCredits += credit;
                totalCourses += 1;
            });
        
            const GPA = totalGrades / totalCredits;
            const fourScaleGPA = totalFourScaleGrades / totalCredits;
            let type = '';
            if      (GPA >= 9)            { type = 'Xuất xắc';   }
            else if (GPA >= 8 && GPA < 9) { type = 'Giỏi';       }
            else if (GPA >= 7 && GPA < 8) { type = 'Khá';        }
            else if (GPA >= 5 && GPA < 7) { type = 'Trung bình'; }
            else if (GPA >= 4 && GPA < 5) { type = 'Yếu';        }
            else                          { type = 'Kém';        }
            
            alert(
                '- Điểm trung bình của bạn : ' + (GPA).toFixed(2) + 
                ' (' + ((fourScaleGPA).toFixed(2)) + '/4)' + '\n' + 
                '- Tổng số tín chỉ đã cày được : ' + totalCredits + '\n' + 
                '- Xếp loại : ' + type
            );
        })();
        ">HCMUS-GPA-bookmarklet</a>

        <ul>
            <li><b>Bước 1:</b> Mở thanh bookmark trên trình duyệt của bạn bằng tổ hợp phím <b>Ctrl + Shift + B</b></li>
            <li><b>Bước 2:</b> Kéo cái thanh hồng hồng xinh xinh ở trên lên thanh bookmark mà bạn vừa mở</li>
            <li><b>Bước 3:</b> Đăng nhập vô <a href="http://portal.hcmus.edu.vn/" target="_blank">Portal</a>:
                <ul>
                    <li>Vào phần <b>Tra cứu kết quả học tập</b></li>
                    <li>Ở phần <b>Năm Học</b>, chọn <b>--Tất cả--</b></li>
                    <li>Nhấn <b>Xem Kết Quả Học Tập</b></li>
                </ul>
            <li><b>Bước 4:</b> Ấn vô cái bookmark bạn vừa tạo là xong :></li>
        </ul>
        
    </div>
</body>
</html>